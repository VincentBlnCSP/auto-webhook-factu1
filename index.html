<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Validation en cours...</title>
  <script>
    window.onload = async function () {
      const params = new URLSearchParams(window.location.search);
      const dealId = params.get("deal_id");
      const statut = params.get("statut"); // üëà Nouveau param√®tre optionnel

      if (!dealId) {
        document.body.innerHTML = "‚ùå Param√®tre 'deal_id' manquant.";
        return;
      }

      // Construction dynamique du body selon la pr√©sence de "statut"
      const body = { deal_id: dealId };
      if (statut !== null) {
        body.statut = statut;
      }

      try {
        await fetch("https://hook.eu2.make.com/n4be46q2qum7f0tjitsdla5b0fz0u24t", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });

        window.close();

        setTimeout(() => {
          window.location.href = "about:blank";
        }, 100);

      } catch (err) {
        console.error(err);
        document.body.innerHTML = "‚ùå Erreur lors de l‚Äôenvoi.";
      }
    };
  </script>
</head>
<body>
  <p>‚è≥ Traitement en cours‚Ä¶</p>
</body>
</html>
