<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Validation en cours...</title>
  <script>
    window.onload = async function () {
      const params = new URLSearchParams(window.location.search);
      const dealId = params.get("deal_id");

      if (!dealId) {
        document.body.innerHTML = "❌ Paramètre 'deal_id' manquant.";
        return;
      }

      try {
        await fetch("https://hook.eu2.make.com/n4be46q2qum7f0tjitsdla5b0fz0u24t", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ deal_id: dealId })
        });

        // Tente de fermer la page
        window.close();

        // Si fermeture échoue, redirige vers une page "fermeture manuelle"
        setTimeout(() => {
          window.location.href = "about:blank"; // ou une vraie page style "c'est fait !"
        }, 100);

      } catch (err) {
        console.error(err);
        document.body.innerHTML = "❌ Erreur lors de l’envoi.";
      }
    };
  </script>
</head>
<body>
  <p>⏳ Traitement en cours…</p>
</body>
</html>
